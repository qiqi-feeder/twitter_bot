# Twitter OAuth 2.0 è®¤è¯æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•é…ç½®å’Œä½¿ç”¨ Twitter OAuth 2.0 è®¤è¯ã€‚

## ğŸ“‹ ç›®å½•

- [ä¸ºä»€ä¹ˆä½¿ç”¨ OAuth 2.0](#ä¸ºä»€ä¹ˆä½¿ç”¨-oauth-20)
- [å‰ç½®è¦æ±‚](#å‰ç½®è¦æ±‚)
- [é…ç½®æ­¥éª¤](#é…ç½®æ­¥éª¤)
- [ä½¿ç”¨æˆæƒå·¥å…·](#ä½¿ç”¨æˆæƒå·¥å…·)
- [æ‰‹åŠ¨é…ç½®](#æ‰‹åŠ¨é…ç½®)
- [Token åˆ·æ–°æœºåˆ¶](#token-åˆ·æ–°æœºåˆ¶)
- [ä»£ç†é…ç½®](#ä»£ç†é…ç½®)
- [æ•…éšœæ’é™¤](#æ•…éšœæ’é™¤)

## ä¸ºä»€ä¹ˆä½¿ç”¨ OAuth 2.0

OAuth 2.0 æ˜¯ Twitter æ¨èçš„è®¤è¯æ–¹å¼ï¼Œç›¸æ¯” OAuth 1.0a æœ‰ä»¥ä¸‹ä¼˜åŠ¿ï¼š

- âœ… **æ›´å®‰å…¨**: ä½¿ç”¨çŸ­æœŸ access_token å’Œé•¿æœŸ refresh_token
- âœ… **è‡ªåŠ¨åˆ·æ–°**: Token è¿‡æœŸåè‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
- âœ… **ç»†ç²’åº¦æƒé™**: å¯ä»¥ç²¾ç¡®æ§åˆ¶åº”ç”¨æƒé™èŒƒå›´
- âœ… **æ›´ç®€å•**: ä¸éœ€è¦å¤æ‚çš„ç­¾åè®¡ç®—

## å‰ç½®è¦æ±‚

1. **Twitter Developer Account**
   - è®¿é—® [Twitter Developer Portal](https://developer.twitter.com/)
   - åˆ›å»ºæˆ–ç™»å½•å¼€å‘è€…è´¦å·

2. **åˆ›å»º Twitter App**
   - åœ¨ Developer Portal ä¸­åˆ›å»ºæ–°åº”ç”¨
   - å¯ç”¨ OAuth 2.0
   - é…ç½®å›è°ƒ URL: `http://localhost:8080/callback`

3. **è·å–å‡­æ®**
   - Client ID
   - Client Secretï¼ˆå¯é€‰ï¼Œç”¨äºæœºå¯†å®¢æˆ·ç«¯ï¼‰

## é…ç½®æ­¥éª¤

### æ­¥éª¤ 1: é…ç½® Client ID

ç¼–è¾‘ `config/config.yaml`ï¼Œå¡«å…¥æ‚¨çš„ Client IDï¼š

```yaml
twitter:
  # OAuth 2.0 Client ID
  client_id: "your_client_id_here"
  
  # OAuth 2.0 Client Secretï¼ˆå¯é€‰ï¼‰
  client_secret: "your_client_secret_here"
```

### æ­¥éª¤ 2: é…ç½®ä»£ç†ï¼ˆå¦‚æœéœ€è¦ï¼‰

å¦‚æœæ‚¨éœ€è¦é€šè¿‡ä»£ç†è®¿é—® Twitter APIï¼Œè¯·é…ç½®ä»£ç†ï¼š

```yaml
proxy:
  socks5_url: "socks5://username:password@proxy_host:port"
  enabled: true
```

### æ­¥éª¤ 3: è¿è¡Œæˆæƒå·¥å…·

ä½¿ç”¨æˆ‘ä»¬æä¾›çš„æˆæƒå·¥å…·è·å– access_token å’Œ refresh_tokenï¼š

```bash
python tools/oauth2_authorize.py
```

å·¥å…·ä¼šï¼š
1. ç”Ÿæˆæˆæƒ URL
2. å¯åŠ¨æœ¬åœ°å›è°ƒæœåŠ¡å™¨
3. ç­‰å¾…æ‚¨åœ¨æµè§ˆå™¨ä¸­å®Œæˆæˆæƒ
4. è‡ªåŠ¨äº¤æ¢ access_token å’Œ refresh_token
5. ä¿å­˜åˆ°é…ç½®æ–‡ä»¶

### æ­¥éª¤ 4: å®Œæˆæˆæƒ

1. åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€å·¥å…·ç”Ÿæˆçš„æˆæƒ URL
2. ç™»å½• Twitter è´¦å·ï¼ˆå¦‚æœæœªç™»å½•ï¼‰
3. æˆæƒåº”ç”¨è®¿é—®æ‚¨çš„è´¦å·
4. æµè§ˆå™¨ä¼šè‡ªåŠ¨è·³è½¬åˆ°æœ¬åœ°å›è°ƒåœ°å€
5. å·¥å…·ä¼šè‡ªåŠ¨å®Œæˆåç»­æ­¥éª¤

### æ­¥éª¤ 5: éªŒè¯é…ç½®

è¿è¡Œæµ‹è¯•è„šæœ¬éªŒè¯é…ç½®ï¼š

```bash
python tools/test_oauth2.py
```

å¦‚æœæ‰€æœ‰æµ‹è¯•é€šè¿‡ï¼Œè¯´æ˜ OAuth 2.0 é…ç½®æˆåŠŸï¼

## ä½¿ç”¨æˆæƒå·¥å…·

### åŸºæœ¬ç”¨æ³•

```bash
python tools/oauth2_authorize.py
```

### æˆæƒæµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. ç”Ÿæˆæˆæƒ URL                                         â”‚
â”‚     - åŒ…å« PKCE å‚æ•°ï¼ˆcode_challengeï¼‰                   â”‚
â”‚     - åŒ…å« state å‚æ•°ï¼ˆé˜²æ­¢ CSRFï¼‰                       â”‚
â”‚     - æŒ‡å®šæƒé™èŒƒå›´ï¼ˆscopesï¼‰                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. ç”¨æˆ·åœ¨æµè§ˆå™¨ä¸­æˆæƒ                                   â”‚
â”‚     - ç™»å½• Twitter è´¦å·                                  â”‚
â”‚     - ç¡®è®¤æˆæƒåº”ç”¨                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. Twitter é‡å®šå‘åˆ°å›è°ƒ URL                             â”‚
â”‚     - æºå¸¦ authorization_code                            â”‚
â”‚     - æºå¸¦ state å‚æ•°                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. æœ¬åœ°æœåŠ¡å™¨æ¥æ”¶å›è°ƒ                                   â”‚
â”‚     - éªŒè¯ state å‚æ•°                                    â”‚
â”‚     - æå– authorization_code                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. äº¤æ¢è®¿é—®ä»¤ç‰Œ                                         â”‚
â”‚     - ä½¿ç”¨ authorization_code                            â”‚
â”‚     - ä½¿ç”¨ code_verifierï¼ˆPKCEï¼‰                         â”‚
â”‚     - è·å– access_token å’Œ refresh_token                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  6. ä¿å­˜ä»¤ç‰Œåˆ°é…ç½®æ–‡ä»¶                                   â”‚
â”‚     - access_token                                       â”‚
â”‚     - refresh_token                                      â”‚
â”‚     - token_expires_at                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## æ‰‹åŠ¨é…ç½®

å¦‚æœæ‚¨å·²ç»æœ‰ access_token å’Œ refresh_tokenï¼Œå¯ä»¥ç›´æ¥é…ç½®ï¼š

```yaml
twitter:
  # OAuth 2.0 Access Token
  access_token: "your_access_token_here"
  
  # OAuth 2.0 Refresh Token
  refresh_token: "your_refresh_token_here"
  
  # Token è¿‡æœŸæ—¶é—´ï¼ˆå¯é€‰ï¼Œè‡ªåŠ¨ç”Ÿæˆï¼‰
  token_expires_at: "2024-12-31T23:59:59"
```

## Token åˆ·æ–°æœºåˆ¶

ç³»ç»Ÿä¼šè‡ªåŠ¨ç®¡ç† Token çš„åˆ·æ–°ï¼š

### è‡ªåŠ¨åˆ·æ–°è§¦å‘æ¡ä»¶

- Token å³å°†è¿‡æœŸï¼ˆæå‰ 5 åˆ†é’Ÿï¼‰
- Token å·²è¿‡æœŸ
- é¦–æ¬¡ä½¿ç”¨æ—¶æ²¡æœ‰è¿‡æœŸæ—¶é—´ä¿¡æ¯

### åˆ·æ–°æµç¨‹

```python
# æ¯æ¬¡è·å– access_token æ—¶è‡ªåŠ¨æ£€æŸ¥
access_token = token_manager.get_access_token()

# å¦‚æœéœ€è¦åˆ·æ–°ï¼Œä¼šè‡ªåŠ¨ï¼š
# 1. ä½¿ç”¨ refresh_token è¯·æ±‚æ–°çš„ access_token
# 2. æ›´æ–°å†…å­˜ä¸­çš„ token
# 3. ä¿å­˜æ–° token åˆ°é…ç½®æ–‡ä»¶
# 4. æ›´æ–°è¿‡æœŸæ—¶é—´
```

### æ‰‹åŠ¨åˆ·æ–°

```python
from auth.token_manager import token_manager

# å¼ºåˆ¶åˆ·æ–° token
success = token_manager._refresh_access_token()
```

## ä»£ç†é…ç½®

æ‰€æœ‰ OAuth 2.0 è¯·æ±‚éƒ½ä¼šè‡ªåŠ¨ä½¿ç”¨é…ç½®çš„ä»£ç†ã€‚

### SOCKS5 ä»£ç†

```yaml
proxy:
  socks5_url: "socks5://username:password@proxy_host:port"
  enabled: true
```

### æ— è®¤è¯ä»£ç†

```yaml
proxy:
  socks5_url: "socks5://proxy_host:port"
  enabled: true
```

### æµ‹è¯•ä»£ç†

```bash
python tools/test_oauth2.py
```

æµ‹è¯•è„šæœ¬ä¼šéªŒè¯ä»£ç†è¿æ¥æ˜¯å¦æ­£å¸¸ã€‚

## æ•…éšœæ’é™¤

### é—®é¢˜ 1: æˆæƒå¤±è´¥

**ç—‡çŠ¶**: æµè§ˆå™¨æ˜¾ç¤ºæˆæƒå¤±è´¥

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ Client ID æ˜¯å¦æ­£ç¡®
- ç¡®è®¤å›è°ƒ URL é…ç½®ä¸º `http://localhost:8080/callback`
- æ£€æŸ¥åº”ç”¨æ˜¯å¦å¯ç”¨äº† OAuth 2.0

### é—®é¢˜ 2: Token åˆ·æ–°å¤±è´¥

**ç—‡çŠ¶**: æ—¥å¿—æ˜¾ç¤º "åˆ·æ–°è®¿é—®ä»¤ç‰Œå¤±è´¥"

**è§£å†³æ–¹æ¡ˆ**:
- æ£€æŸ¥ refresh_token æ˜¯å¦æœ‰æ•ˆ
- ç¡®è®¤ä»£ç†é…ç½®æ­£ç¡®ï¼ˆå¦‚æœä½¿ç”¨ä»£ç†ï¼‰
- æ£€æŸ¥ç½‘ç»œè¿æ¥
- æŸ¥çœ‹è¯¦ç»†é”™è¯¯æ—¥å¿—

### é—®é¢˜ 3: ä»£ç†è¿æ¥å¤±è´¥

**ç—‡çŠ¶**: æ— æ³•è¿æ¥åˆ° Twitter API

**è§£å†³æ–¹æ¡ˆ**:
- éªŒè¯ä»£ç†åœ°å€å’Œç«¯å£
- æ£€æŸ¥ä»£ç†è®¤è¯ä¿¡æ¯
- æµ‹è¯•ä»£ç†æ˜¯å¦æ­£å¸¸å·¥ä½œ
- å°è¯•ç¦ç”¨ä»£ç†æµ‹è¯•

### é—®é¢˜ 4: State éªŒè¯å¤±è´¥

**ç—‡çŠ¶**: "State éªŒè¯å¤±è´¥ï¼Œå¯èƒ½å­˜åœ¨ CSRF æ”»å‡»"

**è§£å†³æ–¹æ¡ˆ**:
- é‡æ–°è¿è¡Œæˆæƒå·¥å…·
- ç¡®ä¿åœ¨åŒä¸€ä¸ªä¼šè¯ä¸­å®Œæˆæˆæƒ
- ä¸è¦é‡å¤ä½¿ç”¨æ—§çš„æˆæƒ URL

## å®‰å…¨å»ºè®®

1. **ä¿æŠ¤é…ç½®æ–‡ä»¶**: ä¸è¦å°†åŒ…å« token çš„é…ç½®æ–‡ä»¶æäº¤åˆ°ç‰ˆæœ¬æ§åˆ¶
2. **å®šæœŸåˆ·æ–°**: ç³»ç»Ÿä¼šè‡ªåŠ¨åˆ·æ–°ï¼Œæ— éœ€æ‰‹åŠ¨å¹²é¢„
3. **æ’¤é”€ä»¤ç‰Œ**: å¦‚æœæ€€ç–‘ token æ³„éœ²ï¼Œç«‹å³æ’¤é”€

```python
from auth.token_manager import token_manager

# æ’¤é”€å½“å‰ token
token_manager.revoke_token()
```

4. **ä½¿ç”¨ HTTPS**: ç”Ÿäº§ç¯å¢ƒä¸­ä½¿ç”¨ HTTPS å›è°ƒ URL

## ç›¸å…³æ–‡æ¡£

- [Twitter OAuth 2.0 å®˜æ–¹æ–‡æ¡£](https://developer.twitter.com/en/docs/authentication/oauth-2-0)
- [PKCE è§„èŒƒ](https://tools.ietf.org/html/rfc7636)
- [OAuth 2.0 è§„èŒƒ](https://tools.ietf.org/html/rfc6749)

## æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·ï¼š
- æŸ¥çœ‹æ—¥å¿—æ–‡ä»¶: `logs/twitter_bot.log`
- è¿è¡Œæµ‹è¯•è„šæœ¬: `python tools/test_oauth2.py`
- æäº¤ Issue: [GitHub Issues](https://github.com/qiqi-feeder/twitter_bot/issues)

